---
slug:  "/projects/action__puppeteer--media"
date:  "2021-08-17"
title: "action__puppeteer--media"
icon:  "shell"
---


# Javascript / Puppeteer Github Action

This github action was born out of slight frustration that:

1. The chromium version that puppeteer uses does not have video codecs installed.
2. Most of the puppeteer actions on the marketplace lack any decent documentation. Which meant it was hard to get anything running.

## Demo Usage Repository

You can see a demonstration of this action in use at: 
https://github.com/IORoot/puppeteer__runner--demo

## How to get it to work?

### New Repository & Package.json

Create a new github repository and include a package.json file.

```
/package.json
```

In the dependencies, you will want to include 'puppeteer-core',

```json
{
    "name": "prunner",
    "version": "1.0.0",
    "author": "Andy Pearson (https://ioroot.com)",
    "description": "Allows you to run puppeteer scripts.",
    "license": "MIT",
    "main": "puppeteer.js",
    "dependencies": {
        "puppeteer-core": "^5.4.1"
    }
}
```

### Your puppeteer script.

Next, you'll want to include your own script that will run puppeteer and do whatever
it is you want it to do.

```
/myscript.js
/package.json
```

This script will need to reference chrome in a specific location: `/usr/bin/google-chrome-stable`

```js

    const puppeteer = require('puppeteer-core');
    browser = puppeteer.launch({ 
        headless: true, 
        devtools: false,
        executablePath: "/usr/bin/google-chrome-stable",
        args: ['--no-sandbox']
    });

```

You should now be able to run your puppeteer steps in your script.



### Github Action

Lastly, to run the whole process, you need to create a github action workflow file.

```
/.github/workflows/run_action.yml
/myscript.js
/package.json
```

This workflow action will include the bare minimum of:

```yaml
name: Demo puppeteer script

on:
  workflow_dispatch:

jobs:
  demo:
    runs-on: ubuntu-latest
    steps:

    # Copy contents of this repository into runner.
    - uses: actions/checkout@master

    # Run the "Args" as a command in the docker container
    # created by this action. 'npm install' will run.
    - name: Install
      uses: IORoot/action__puppeteer--media@master
      with:
        args: npm install

    # Run the "Args" as a command in the docker container
    # created by this action. 'node myscript.js' will run
    - name: Test Code
      uses: IORoot/action__puppeteer--media@master
      with:
        args: node myscript.js

```


### package.json 'scripts'

Instead of running the `node myscript.js` in the 'args', you could transfer the execution
into the package.json like so:

```json
{
    "name": "prunner",
    "version": "1.0.0",
    "author": "Andy Pearson (https://ioroot.com)",
    "description": "Allows you to run puppeteer scripts.",
    "license": "MIT",
    "main": "puppeteer.js",
    "dependencies": {
        "puppeteer-core": "^5.4.1"
    },
    "scripts": {
        "start": "node myscript.js"
    }
}
```

You could then run `npm run start` as the command in 'args'.

```yaml
    - name: Test Code
      uses: IORoot/action__puppeteer--media@master
      with:
        args: npm run start
```


## Note about Video Codecs in Chromium.

IMPORTANT - Some puppeteer scripts will not run correctly when using a version of chromium that
has NOT been compiled with the video/audio codecs. Chrome comes with them as standard
but Chromium does not.

Manually, You can download a copy of Chromium with those codecs here:
https://chromium.woolyss.com/ to query these routes.

You can then set the `executablePath` of puppeteer-core in the puppeteer settings
to point to this version of chromium.

Warning - If you do not do this, then chromium will not upload any videos because 
it will not recognise those file formats. Images will work, however.

Why did I need this? Well, I had created a puppeteer script that was navigating to
the facebook creator studio and uploading an instagram video. However, it would not
work because chrome couldn't handle the MP4 files being uploaded. So a different 
version was required.

```php
/**
 * ISSUE - CHROMIUM NOT ABLE TO UPLOAD VIDEO
 * 
 * https://github.com/puppeteer/puppeteer/issues/291
 * 
 * Chromium cannot upload video, however, Chrome can. This is 
 * because chromium is compiled without any codec support. Therefore,
 * use a chromium version WITH support or use Chrome.
 * 
 * You can download a chromium version here:
 * https://chromium.woolyss.com/#mac-stable-ungoogled-marmaduke
 * 
 * Change the executablePath to a google chrome instance
 * executablePath: "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"
 */
 ```

